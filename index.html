<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<title>The Oath Beavers Association - Membership Card Creator Tool</title>
<link rel="icon" href="oath.png" type="image/png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
</head>

<body>
  <nav class="navbar">
     <div class="nav-left">
     </div>
     <div class="nav-center">
     <div class="logo">
      <img src="logo.png" alt="">
     </div>
     </div>
     <div class="nav-right">
      <button class="nav-btn github" onclick="showLink('Github Profiline Yönlendiriliyorsun...', `https://github.com/Forbibden`)">
       <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" alt="GitHub">
        GitHub
       </button>
      </div>
  </nav>
  <div id="toast-box"></div>
  <div class="link-panel" id="linkPanel">
  <img src="https://avatars.githubusercontent.com/u/63154487?v=4" alt="Profil Fotoğrafı">
    <h2>Yönlendiriliyorsun...</h2>
    <span>Github Profiline Yönlendiriliyorsun...</span>
  </div>
<div class="page-wrapper">
  <section class="hero-section">
    <div class="warn-box">
  <i class="fa-solid fa-circle-info" style="color: #2f8fed;"></i> 
  Bu araç, "The Oath Beavers Association" üyelik kartlarını oluşturmak içindir. 
  Her karakterin yanlızca bir adet "The Oath Beavers Association" üyelik kartı bulunabilir.
</div>
<!-- ÜYELİK KARTI OLUŞTURMA BÖLÜMÜ -->
    <div class="card-section">
    <div class="panel">
      <span class="title">Üyelik Kartı Oluştur</span>
      <label>Fotoğraf</label>
      <input class="custom-file-input" type="file" id="photoInput" accept="image/*" hidden required>
      <div class="drop-area">
        <i class="fa fa-upload"></i>
        <span>Resmi yüklemek için sürükleyip bırakın veya buraya tıklayın</span>
      </div>
     
      <label>İsim</label>
      <input type="text" id="nameInput" placeholder="Ad Soyad" required value="Jane Doe">

      <label>Cinsiyet</label>
      <select id="sexInput" required>
        <option value="Female">Female</option>
        <option value="Male">Male</option>
      </select>

      <label>Servis</label>
      <select id="serviceInput" required>
        <option value="District Attorney’s Office">District Attorney’s Office</option>
        <option value="LS County Sheriff's Department">LS County Sheriff's Department</option>
        <option value="LS Police Department">LS Police Department</option>
        <option value="LS Fire Department">LS Fire Department</option>
        <option value="SA Department of Corrections">SA Department of Corrections</option>
        <option value="LS City Government">LS City Government</option>
      </select>

      <label>ID</label>
      <input type="number" id="idInput" placeholder="Yalnızca Ticket NO" required value="0000">
      <button id="downloadBtn" onclick="downloadCard()" type="submit" style="margin-top: 2rem;"><i class="fa-solid fa-cloud-arrow-down"></i> Kartı İndir</button>
      <button id="shareBtn"><i class="fa-solid fa-share-nodes"></i> Paylaş</button>
    </div>
 <!-- SAĞ TARAF: KART ÖNİZLEME -->
    <div class="preview">
      <canvas id="cardCanvas"></canvas>
    </div>
  </div>
  </section>

  <!-- ÜYELİK KARTI REHBER BÖLÜMÜ -->
   <section class="info-section">
    <div class="info-box">
      <span class="title">1</span>
        <div class="command" id="command">/myitemsex</div>
          <p class="note">
              Bu komut, envanterinizdeki <span class="important">note kartlarının listesini</span> görmenizi sağlar ve hangi numarada olduğunu öğrenmenize yardımcı olur. Böylece bir sonraki adımlarda doğru kart üzerinde işlem yapabilirsiniz.
          </p>
          <div class="command" id="command">/note x 1 ad <b>The Oath Beavers - Üyelik Kartı</b></div>
          <p class="note">
              Burada <span class="important">"x"</span> yerine envanterinizdeki kartın numarasını yazmanız gerekiyor. Bu komut, seçtiğiniz kartın adını değiştirmeye veya doğrulamaya yarar. Kartın adı mutlaka <span class="important">"The Oath Beavers - Üyelik Kartı"</span> olmalıdır.
          </p>
          
      </div>
    
    <div class="info-box">
      <span class="title">2</span>
          <div class="command" id="command">/iconpicker</div>
          <p class="note">
              Bu komutu yazdığınızda, önünüze bir ikon seçim menüsü çıkar. Menüde <span class="important">"Diğer"</span> kısmına gidip üçüncü satırın soldan dördüncü simgesini seçmelisiniz. Seçtiğiniz ikon, kartın görsel temsili olarak kullanılacaktır.
          </p>
          <div class="command" id="command">/note x 1 ikon</div>
          <p class="note">
              Bu komut, iconpicker ile seçtiğiniz ikonu kartınıza uygular. Kartın görünümünü kişiselleştirmek ve tanınmasını sağlamak için bu adım önemlidir. <span class="important">"x"</span> yine kartın envanter numarasıdır.
          </p>
    </div>
    <div class="info-box">
      <span class="title">3</span>
      <div class="command" id="command">/note x 1 içerik url.jpeg</div>
        <p class="note">
            Bu komut, kartın içerisine görsel veya metin eklemenizi sağlar. Buradaki örnek link, imgur üzerinde önceden yüklenmiş bir görseldir. Kendi hazırladığınız kart görselini kullanmak için, resmi imgura yükleyin, sağ tıklayıp “resim adresini kopyala” yapın ve linki buraya yapıştırın. Bu adım, kartın içeriğinin görsel olarak tamamlanmasını sağlar ve kartın hem görünümünü hem de işlevini tamamlar.
        </p>
    </div>
  </section>
  <!-- ALT BİLGİ / REHBER ALANI -->
</div>
<script>
// Canvas işlemleri
const canvas = document.getElementById('cardCanvas');
const ctx = canvas.getContext('2d');
const nameInput = document.getElementById('nameInput');
const sexInput = document.getElementById('sexInput');
const serviceInput = document.getElementById('serviceInput');
const idInput = document.getElementById('idInput');
const photoInput = document.getElementById('photoInput');
const dropArea = document.querySelector('.drop-area');
const dropText = dropArea.querySelector('span');
const downloadBtn = document.getElementById('downloadBtn');
const toastBox = document.getElementById('toast-box');
const linkPanel = document.getElementById("linkPanel");
const linkText = linkPanel.querySelector('span');
const shareBtn = document.getElementById("shareBtn");

let photoImg = null;
let templateImg = new Image();


templateImg.onload = () => {
  canvas.width = templateImg.width;
  canvas.height = templateImg.height;
  render();
};
templateImg.src = "sablon.png";

function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(templateImg, 0, 0);

  if (photoImg) {
    const x = 392, y = 794.3, w = 348, h = 470;
    ctx.save();
    ctx.beginPath();
    ctx.rect(x, y, w, h);
    ctx.clip();
    drawImageCover(ctx, photoImg, x, y, w, h);
    ctx.restore();
  }

  ctx.fillStyle = '#000';
  ctx.textBaseline = 'top';
  ctx.font = 'bold 40px Arial';
  ctx.fillText(nameInput.value || '', 1000, 820);
  ctx.font = '40px Arial';
  ctx.fillText(sexInput.value || '', 1000, 867);
  ctx.fillText(serviceInput.value || '', 1000, 910);
  ctx.fillStyle = '#ff0000d9';
  ctx.fillText(idInput.value || '', 1000, 955);

  const canvasEl = document.getElementById("cardCanvas");

  canvasEl.style.opacity = 0;
  canvasEl.style.transform = 'scale(0.95)';

  setTimeout(() => {
    canvasEl.style.opacity = 1;
    canvasEl.style.transform = 'scale(1)';
  }, 50);
  }

function drawImageCover(ctx, img, x, y, w, h) {
  const iw = img.width, ih = img.height;
  const r = Math.max(w / iw, h / ih);
  const nw = iw * r, nh = ih * r;
  const cx = (nw - w) / 2, cy = (nh - h) / 2;
  ctx.drawImage(img, -cx + x, -cy + y, nw, nh);
}
function handleFile(file) {
  if (!file) return;

  dropText.textContent = `Dosya Yüklendi: ${file.name}`;

  const img = new Image();
  img.onload = () => {
    photoImg = img;
    render();
  };
  img.src = URL.createObjectURL(file);
}
dropArea.addEventListener('click', () => {
  photoInput.click();
});


photoInput.addEventListener('change', (e) => {
  handleFile(e.target.files[0]);
});


dropArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropArea.style.borderColor = 'cadetblue';
  dropText.textContent = `Bırak yükle!`;
});


dropArea.addEventListener('dragleave', () => {
  dropArea.style.borderColor = '#333';
  dropText.textContent = `Resmi yüklemek için sürükleyip bırakın veya buraya tıklayın`;
});


dropArea.addEventListener('drop', (e) => {
  e.preventDefault();
  dropArea.style.borderColor = '#333';
  const file = e.dataTransfer.files[0];
  if (file) {
    photoInput.files = e.dataTransfer.files; 
    handleFile(file);
  }
});

[nameInput, sexInput, serviceInput, idInput].forEach(input => {
  input.addEventListener('input', render);
  input.addEventListener('change', render);
});

function triggerButtonError(){
  downloadBtn.classList.add('error');
  setTimeout(() => downloadBtn.classList.remove('error'), 800);
}
function validateInputs() {
  const fields = [
    { el: photoInput, condition: photoInput.files.length, highlight: dropArea },
    { el: nameInput, condition: nameInput.value.trim() },
    { el: idInput, condition: idInput.value.trim() }
  ];

  let valid = true;

  fields.forEach(f => {
    if (!f.condition) {
      valid = false;
      if (f.highlight) {
        f.highlight.classList.add('error');
        setTimeout(() => f.highlight.classList.remove('error'), 800);
      } else {
        f.el.classList.add('error');
        setTimeout(() => f.el.classList.remove('error'), 800);
      }
      showToast(`Lütfen Boşlukları Uygun Şekilde Doldurun!`, 'error');
    }
  });

  if (!valid) triggerButtonError();
  return valid;
}
function downloadCard() {
  if (!validateInputs()) return;

  if (!canvas.toBlob) {
    showToast('Tarayıcınız bu işlemi desteklemiyor.', 'error');
    return;
  }

  canvas.toBlob(blob => {
    if (!blob) {
      showToast('Kart oluşturulamadı (blob null).', 'error');
      return;
    }
    const fileUrl = URL.createObjectURL(blob);
    const a = document.createElement('a');

    downloadBtn.disabled = true;
    downloadBtn.textContent = 'Kart İndiriliyor...';

    a.href = fileUrl;
    a.download = `${(nameInput.value || 'card').replace(/\s+/g, '_')}-The_Oath_Beavers.png`;

    showToast(`${a.download} indiriliyor...`, 'info');

    document.body.appendChild(a);
    a.click();

    setTimeout(() => {
      URL.revokeObjectURL(fileUrl);
      a.remove(); 
      downloadBtn.disabled = false;
      downloadBtn.textContent = 'Kart İndir';
    }, 500);
  }, 'image/png');
}
/*document.getElementById('downloadBtn').addEventListener('click', () => {
   if (!validateInputs()) return;
  canvas.toBlob(blob => {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `${nameInput.value}-The Oath Beavers Association.png`;
    showToast(`${nameInput.value}-The Oath Beavers Association.png İndiriliyor...`)
    a.click();
    URL.revokeObjectURL(a.href);
  }, 'image/png');
});
*/
document.querySelectorAll('.command').forEach(cmd => {
  cmd.addEventListener('click', () => {
    const text = cmd.textContent.trim();

    navigator.clipboard.writeText(text).then(() => {
      cmd.classList.add('copied');
      cmd.textContent = 'Panoya Kopyalandı!';
      showToast(`"${text}" Kopyalandı!`, `success`);
      setTimeout(() => {
        cmd.classList.remove('copied');
        cmd.textContent = text;
      }, 1200);
    }).catch(() => {
      showToast('Kopyalama aşarısız!');
    });
  });
});

function showToast(message, status, icon='fa-circle-info', duration=3000){
  const toast = document.createElement('Div');
  
  toast.className = 'toast';
  toast.innerHTML = `<i class="fa-solid ${icon}"></i> ${message}`
  toast.classList.add(`${status}`);
  toastBox.appendChild(toast);

  setTimeout(() => {
      toast.style.animation = 'toastOut 0.4s forwards';
      setTimeout(() => toast.remove(), 400);
  }, duration);
}

function showLink(message, url){
  linkText.textContent = `${message}`;
  linkPanel.classList.add("show");

  setTimeout(() => {
    window.location.href = `${url}`;
    linkPanel.classList.remove("show");
  }, 3000);
}

window.addEventListener("pageshow", () => {
    linkPanel.classList.remove("show");
  });

document.addEventListener('keydown', e => {
  if(e.key === 'Enter') downloadCard();
  if (e.key === 'Escape') document.querySelectorAll('.toast').forEach(t => t.remove());
});

[nameInput, sexInput, serviceInput, idInput].forEach(input => {
  input.addEventListener('input', () => {
    localStorage.setItem(input.id, input.value);
  });
  const saved = localStorage.getItem(input.id);
  if (saved) input.value = saved;
});

shareBtn.addEventListener('click', () => {
  shareCard();
});

function shareCard() {
  canvas.toBlob(async (blob) => {
    const file = new File([blob], `${nameInput.value}-card.png`, { type: 'image/png' });

    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      await navigator.share({
        title: 'The Oath Beavers Association',
        text: `${nameInput.value}'ın üyelik kartı hazır!`,
        files: [file],
      });
    } else {
      showToast("Bu tarayıcı paylaşımı desteklemiyor!", "fa-triangle-exclamation");
    }
  });
}
</script>
</body>
</html>
